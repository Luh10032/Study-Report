20220321~20220327

### unit 2 应用层
- 网路核心没有应用层功能

#### 2.6 P2P应用
- 纯P2P架构
1. 几乎没有一直运行的服务器
2. 任意端系统都可以直接通信
3. 利用peer（对等体 端节点）的服务能力
4. peer节点间歇上网，每次IP地址都可能有变化

- 分发时间：所有N个peer得到文件的副本的时间

- CS 模式
- 服务器传输：服务器发送给peer，服务器必须顺序上载N个问文件的拷贝，设服务器上载速度为u_s,文件大小F 则发送一个文件的copy时间为 F/u_s
- 客户端：每个客户端必须下载一个文件的copy，设d_min为最慢的客户端的下载速率，则该客户端下载时间为F/d_min,
- CS模式下，将F大小的文件分发给N个客户端的耗时为：D_cs>=max( NF/u_s , F/d_min   )

- P2P 模式
- 服务器传输：至少需要上载一份拷贝 发送拷贝时间=F/u_s
- 客户端：每个客户端必须下载一个拷贝。最小下载带宽客户单耗时：F/d_mi，
所有客户端总体下载量=NF。服务器和peer节点斗可以上载，所以最大上载带宽是u_s+u_sum,
u_sum为客户端上载带宽总和。
- 将F大小的文件分发给N个客户端耗时:D_p2p>=max(F/u_s , F/d_min , NF/(u_s+u_sum) )

- BitTorrrent
- 洪流(torrent):参与一个特定文件分发的所有对等方的集合
- tit-for-tat


#### 2.7 CDN
- DASH  Dynamic Adaptive Streaming over HTTP:经HTTP的动态适应流
- 服务器：
1. 将文件分成多个块，每块独立存储，编码于不同码率，
2. HTTP服务器有一个告示文件manifest file，提供不同块的URL
- 客户端：
1. 先获取告示文件
2. 周期性地测量服务器到客户端的带宽
3. 查询告示文件，在一个时刻请求一个块，HTTP头部指定字节范围，如果带宽足够，选择最大码率的视频看。

- CDN：Content distribution networks 内容分发网


#### 2.8 TCP套接字编程

###### Socket编程
- 应用进程使用传输层提供的服务才能交换报文，实现应用协议。
- TCP/IP :应用进程使用socket api访问传输服务
- 地点：界面上的SAP service access point 
- 方式： socket api 
- socket：分布式应用进程之间的门，传输层协议提供的端到端服务接口
- 2种传输层服务器的socket类型：
>1. TCP:可靠的，字节流服务
>2. 不可靠（数据UDP数据报服务）

TCP套接字编程：
1. 服务器首先运行，等待连接建立
>1. 创建欢迎socket
>1. 和本地端口捆绑
>1. 在欢迎socket上阻塞式等待接收用户的连接

1. 客户端主动和服务器建立连接:
>1. 创建客户端本地套接字（隐式捆绑到本地）
>1. 指定服务器进程的IP地址和端口号，与服务器进程连接
>1. 连接API调用有效时，客户端与服务器建立的了TCP连接

1. 当客户端连接请求到来时：
>1. 服务器接收来自用户端的请求，解除阻塞式等待，返回一个新的socket（
 与欢迎socket不一样），与客户端通信。
> 允许服务器与多个客户端通信
> 使用源IP和源端口来区分不同的客户端
- 从应用程序的角度来说：TCP在客户端和服务器进程之间提供了可靠的，字节流管道服务

- UDP socket编程
- UDP在客户端和服务器之间没有连接
- 没有握手
- 发送端在每一个报文中明确地指定目标的IP地址和端口号
- 服务器必须从收到的分组中提取出发送端的IP地址和端口号
- UDP：传送的数据可能乱序，也可能丢失